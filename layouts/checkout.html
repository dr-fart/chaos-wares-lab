{{ define "main" }}
<div class="container">
    <div class="page-header">
        <h1>Checkout</h1>
    </div>
    
    <div class="checkout-container">
        <div class="cart-summary">
            <h2>Order Summary</h2>
            <div class="cart-items" id="checkout-cart-items">
                <!-- Cart items will be populated by JavaScript -->
            </div>
            <div class="cart-total" id="checkout-cart-total">
                Total: $0.00
            </div>
        </div>
        
        <div class="form-container">
            <h2>Payment Information</h2>
            <form id="checkout-form">
                <div class="form-group">
                    <label for="card-number">Credit Card Number</label>
                    <input type="text" id="card-number" name="cardNumber" placeholder="1234 5678 9012 3456" required>
                </div>
                <div class="form-group">
                    <label for="expiry">Expiry Date</label>
                    <input type="text" id="expiry" name="expiry" placeholder="MM/YY" required>
                </div>
                <div class="form-group">
                    <label for="cvc">CVC</label>
                    <input type="text" id="cvc" name="cvc" placeholder="123" required>
                </div>
                <button type="submit" class="btn cta-button">Place Order</button>
            </form>
        </div>
    </div>
</div>
{{ end }}

{{ define "scripts" }}
<script>
// Load and display cart items
function loadCart() {
    const cart = JSON.parse(localStorage.getItem('cart') || '[]');
    const cartItemsContainer = document.getElementById('checkout-cart-items');
    const cartTotalElement = document.getElementById('checkout-cart-total');
    
    if (cart.length === 0) {
        cartItemsContainer.innerHTML = '<p>Your cart is empty.</p>';
        cartTotalElement.textContent = 'Total: $0.00';
        return;
    }
    
    let total = 0;
    cartItemsContainer.innerHTML = '';
    
    cart.forEach(item => {
        const itemTotal = item.price * item.quantity;
        const cartItem = document.createElement('div');
        cartItem.className = 'cart-item';
        cartItem.innerHTML = `
            <div class="cart-item-info">
                <h4>${item.name}</h4>
                <p>SKU: ${item.sku}</p>
                <p>Quantity: ${item.quantity}</p>
            </div>
            <div class="cart-item-price">$${itemTotal.toFixed(2)}</div>
        `;
        cartItemsContainer.appendChild(cartItem);
        total += itemTotal;
    });
    
    cartTotalElement.textContent = `Total: $${total.toFixed(2)}`;
}

// Handle checkout form submission
document.getElementById('checkout-form').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const cart = JSON.parse(localStorage.getItem('cart') || '[]');
    
    if (cart.length === 0) {
        alert('Your cart is empty!');
        return;
    }
    
    const formData = {
        items: cart,
        payment: {
            cardNumber: document.getElementById('card-number').value,
            expiry: document.getElementById('expiry').value,
            cvc: document.getElementById('cvc').value
        }
    };
    
    try {
        const response = await fetch('/api/v1/cart/checkout', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(formData)
        });
        
        if (response.ok) {
            alert('Order placed successfully!');
            localStorage.removeItem('cart');
            updateCartCount();
            window.location.href = '/';
        } else {
            alert('Checkout failed. Please try again.');
        }
    } catch (error) {
        console.error('Checkout error:', error);
        alert('Checkout request failed. Please try again.');
    }
});

// Load cart on page load
document.addEventListener('DOMContentLoaded', loadCart);
</script>
{{ end }}
